<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tidy, Type-Safe 'prediction()' Methods • prediction</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Tidy, Type-Safe 'prediction()' Methods">
<meta property="og:description" content="A one-function package containing 'prediction()', a type-safe alternative to 'predict()' that always returns a data frame. The 'summary()' method provides a data frame with average predictions, possibly over counterfactual versions of the data (a la the 'margins' command in Stata). Marginal effect estimation is provided by the related package, 'margins' &lt;https://cran.r-project.org/package=margins&gt;. The package currently supports common model types (e.g., &quot;lm&quot;, &quot;glm&quot;) from the 'stats' package, as well as numerous other model classes from other add-on packages. See the README or main package documentation page for a complete listing.">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">prediction</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.3.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/leeper/prediction">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<p><img src="reference/figures/logo.png" align="right"></p>
<p>The <strong>prediction</strong> and <strong>margins</strong> packages are a combined effort to port the functionality of Stata’s (closed source) <a href="http://www.stata.com/help.cgi?margins"><code>margins</code></a> command to (open source) R. <strong>prediction</strong> is focused on one function - <code><a href="reference/prediction.html">prediction()</a></code> - that provides type-safe methods for generating predictions from fitted regression models. <code><a href="reference/prediction.html">prediction()</a></code> is an S3 generic, which always return a <code>"data.frame"</code> class object rather than the mix of vectors, lists, etc. that are returned by the <code>predict()</code> methods for various model types. It provides a key piece of underlying infrastructure for the <strong>margins</strong> package. Users interested in generating marginal (partial) effects, like those generated by Stata’s <code>margins, dydx(*)</code> command, should consider using <code>margins()</code> from the sibling project, <a href="https://cran.r-project.org/package=margins"><strong>margins</strong></a>.</p>
<p>In addition to <code><a href="reference/prediction.html">prediction()</a></code>, this package provides a number of utility functions for generating useful predictions:</p>
<ul>
<li>
<code><a href="reference/find_data.html">find_data()</a></code>, an S3 generic with methods that find the data frame used to estimate a regression model. This is a wrapper around <code>get_all_vars()</code> that attempts to locate data as well as modify it according to <code>subset</code> and <code>na.action</code> arguments used in the original modelling call.</li>
<li>
<code><a href="reference/mean_or_mode.html">mean_or_mode()</a></code> and <code><a href="reference/mean_or_mode.html">median_or_mode()</a></code>, which provide a convenient way to compute the data needed for predicted values <em>at means</em> (or <em>at medians</em>), respecting the differences between factor and numeric variables.</li>
<li>
<code><a href="reference/seq_range.html">seq_range()</a></code>, which generates a vector of <em>n</em> values based upon the range of values in a variable</li>
<li>
<code><a href="reference/build_datalist.html">build_datalist()</a></code>, which generates a list of data frames from an input data frame and a specified set of replacement <code>at</code> values (mimicking the <code>atlist</code> option of Stata’s <code>margins</code> command)</li>
</ul>
<div id="simple-code-examples" class="section level2">
<h2 class="hasAnchor">
<a href="#simple-code-examples" class="anchor"></a>Simple code examples</h2>
<p>A major downside of the <code>predict()</code> methods for common modelling classes is that the result is not type-safe. Consider the following simple example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"stats"</span>)
<span class="kw">library</span>(<span class="st">"datasets"</span>)
x &lt;-<span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>cyl <span class="op">*</span><span class="st"> </span>hp <span class="op">+</span><span class="st"> </span>wt, <span class="dt">data =</span> mtcars)
<span class="kw">class</span>(<span class="kw">predict</span>(x))</code></pre></div>
<pre><code>## [1] "numeric"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(<span class="kw">predict</span>(x, <span class="dt">se.fit =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>## [1] "list"</code></pre>
<p><strong>prediction</strong> solves this issue by providing a wrapper around <code>predict()</code>, called <code><a href="reference/prediction.html">prediction()</a></code>, that always returns a tidy data frame with a very simple <code>print()</code> method:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"prediction"</span>)
(p &lt;-<span class="st"> </span><span class="kw"><a href="reference/prediction.html">prediction</a></span>(x))</code></pre></div>
<pre><code>## Data frame with 32 predictions from
##  lm(formula = mpg ~ cyl * hp + wt, data = mtcars)
## with average prediction: 20.0906</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(p)</code></pre></div>
<pre><code>## [1] "prediction" "data.frame"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(p)</code></pre></div>
<pre><code>##    mpg cyl disp  hp drat    wt  qsec vs am gear carb   fitted se.fitted
## 1 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4 21.90488 0.6927034
## 2 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4 21.10933 0.6266557
## 3 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1 25.64753 0.6652076
## 4 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1 20.04859 0.6041400
## 5 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2 17.25445 0.7436172
## 6 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1 19.53360 0.6436862</code></pre>
<p>The output always contains the original data (i.e., either data found using the <code><a href="reference/find_data.html">find_data()</a></code> function or passed to the <code>data</code> argument to <code><a href="reference/prediction.html">prediction()</a></code>). This makes it much simpler to pass predictions to, e.g., further summary or plotting functions.</p>
<p>Additionally the vast majority of methods allow the passing of an <code>at</code> argument, which can be used to obtain predicted values using modified version of <code>data</code> held to specific values:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="reference/prediction.html">prediction</a></span>(x, <span class="dt">at =</span> <span class="kw">list</span>(<span class="dt">hp =</span> <span class="kw"><a href="reference/seq_range.html">seq_range</a></span>(mtcars<span class="op">$</span>hp, <span class="dv">5</span>)))</code></pre></div>
<pre><code>## Data frame with 160 predictions from
##  lm(formula = mpg ~ cyl * hp + wt, data = mtcars)
## with average predictions:</code></pre>
<pre><code>##     hp      x
##   52.0 22.605
##  122.8 19.328
##  193.5 16.051
##  264.2 12.774
##  335.0  9.497</code></pre>
<p>This more or less serves as a direct R port of (the subset of functionality of) Stata’s <code>margins</code> command that calculates predictive marginal means, etc. For calculation of marginal or partial effects, see the <a href="https://cran.r-project.org/package=margins"><strong>margins</strong></a> package.</p>
</div>
<div id="supported-model-classes" class="section level2">
<h2 class="hasAnchor">
<a href="#supported-model-classes" class="anchor"></a>Supported model classes</h2>
<p>The currently supported model classes are:</p>
<ul>
<li>“lm” from <code><a href="http://www.rdocumentation.org/packages/stats/topics/lm">stats::lm()</a></code>
</li>
<li>“glm” from <code><a href="http://www.rdocumentation.org/packages/stats/topics/glm">stats::glm()</a></code>, <code><a href="http://www.rdocumentation.org/packages/MASS/topics/glm.nb">MASS::glm.nb()</a></code>, <code><a href="http://www.rdocumentation.org/packages/glmx/topics/glmx">glmx::glmx()</a></code>, <code><a href="http://www.rdocumentation.org/packages/glmx/topics/hetglm">glmx::hetglm()</a></code>, <code><a href="http://www.rdocumentation.org/packages/brglm/topics/brglm">brglm::brglm()</a></code>
</li>
<li>“ar” from <code><a href="http://www.rdocumentation.org/packages/stats/topics/ar">stats::ar()</a></code>
</li>
<li>“Arima” from <code><a href="http://www.rdocumentation.org/packages/stats/topics/arima">stats::arima()</a></code>
</li>
<li>“arima0” from <code><a href="http://www.rdocumentation.org/packages/stats/topics/arima0">stats::arima0()</a></code>
</li>
<li>“biglm” from <code><a href="http://www.rdocumentation.org/packages/biglm/topics/biglm">biglm::biglm()</a></code> (including <code>"ffdf"</code> backed models)</li>
<li>“bigLm” from <code>bigLm::bigLm()</code>
</li>
<li>“betareg” from <code><a href="http://www.rdocumentation.org/packages/betareg/topics/betareg">betareg::betareg()</a></code>
</li>
<li>“bruto” from <code><a href="http://www.rdocumentation.org/packages/mda/topics/bruto">mda::bruto()</a></code>
</li>
<li>“clm” from <code><a href="http://www.rdocumentation.org/packages/ordinal/topics/clm">ordinal::clm()</a></code>
</li>
<li>“coxph” from <code><a href="http://www.rdocumentation.org/packages/survival/topics/coxph">survival::coxph()</a></code>
</li>
<li>“crch” from <code><a href="http://www.rdocumentation.org/packages/crch/topics/crch">crch::crch()</a></code>
</li>
<li>“earth” from <code><a href="http://www.rdocumentation.org/packages/earth/topics/earth">earth::earth()</a></code>
</li>
<li>“fda” from <code><a href="http://www.rdocumentation.org/packages/mda/topics/fda">mda::fda()</a></code>
</li>
<li>“Gam” from <code><a href="http://www.rdocumentation.org/packages/gam/topics/gam">gam::gam()</a></code>
</li>
<li>“gausspr” from <code><a href="http://www.rdocumentation.org/packages/kernlab/topics/gausspr">kernlab::gausspr()</a></code>
</li>
<li>“gee” from <code><a href="http://www.rdocumentation.org/packages/gee/topics/gee">gee::gee()</a></code>
</li>
<li>“glimML” from <code><a href="http://www.rdocumentation.org/packages/aod/topics/betabin">aod::betabin()</a></code>, <code><a href="http://www.rdocumentation.org/packages/aod/topics/negbin">aod::negbin()</a></code>
</li>
<li>“glimQL” from <code><a href="http://www.rdocumentation.org/packages/aod/topics/quasibin">aod::quasibin()</a></code>, <code><a href="http://www.rdocumentation.org/packages/aod/topics/quasipois">aod::quasipois()</a></code>
</li>
<li>“glmnet” from <code><a href="http://www.rdocumentation.org/packages/glmnet/topics/glmnet">glmnet::glmnet()</a></code>
</li>
<li>“gls” from <code><a href="http://www.rdocumentation.org/packages/nlme/topics/gls">nlme::gls()</a></code>
</li>
<li>“hurdle” from <code><a href="http://www.rdocumentation.org/packages/pscl/topics/hurdle">pscl::hurdle()</a></code>
</li>
<li>“hxlr” from <code><a href="http://www.rdocumentation.org/packages/crch/topics/hxlr">crch::hxlr()</a></code>
</li>
<li>“ivreg” from <code><a href="http://www.rdocumentation.org/packages/AER/topics/ivreg">AER::ivreg()</a></code>
</li>
<li>“knnreg” from <code><a href="http://www.rdocumentation.org/packages/caret/topics/knnreg">caret::knnreg()</a></code>
</li>
<li>“kqr” from <code><a href="http://www.rdocumentation.org/packages/kernlab/topics/kqr">kernlab::kqr()</a></code>
</li>
<li>“ksvm” from <code><a href="http://www.rdocumentation.org/packages/kernlab/topics/ksvm">kernlab::ksvm()</a></code>
</li>
<li>“lda” from <code>MASS:lda()</code>
</li>
<li>“lme” from <code><a href="http://www.rdocumentation.org/packages/nlme/topics/lme">nlme::lme()</a></code>
</li>
<li>“loess” from <code><a href="http://www.rdocumentation.org/packages/stats/topics/loess">stats::loess()</a></code>
</li>
<li>“lqs” from <code><a href="http://www.rdocumentation.org/packages/MASS/topics/lqs">MASS::lqs()</a></code>
</li>
<li>“mars” from <code><a href="http://www.rdocumentation.org/packages/mda/topics/mars">mda::mars()</a></code>
</li>
<li>“mca” from <code><a href="http://www.rdocumentation.org/packages/MASS/topics/mca">MASS::mca()</a></code>
</li>
<li>“mclogit” from <code><a href="http://www.rdocumentation.org/packages/mclogit/topics/mclogit">mclogit::mclogit()</a></code>
</li>
<li>“mda” from <code><a href="http://www.rdocumentation.org/packages/mda/topics/mda">mda::mda()</a></code>
</li>
<li>“merMod” from <code><a href="http://www.rdocumentation.org/packages/lme4/topics/lmer">lme4::lmer()</a></code> and <code><a href="http://www.rdocumentation.org/packages/lme4/topics/glmer">lme4::glmer()</a></code>
</li>
<li>“mnlogit” from <code><a href="http://www.rdocumentation.org/packages/mnlogit/topics/mnlogit">mnlogit::mnlogit()</a></code>
</li>
<li>“mnp” from <code><a href="http://www.rdocumentation.org/packages/MNP/topics/mnp">MNP::mnp()</a></code>
</li>
<li>“naiveBayes” from <code><a href="http://www.rdocumentation.org/packages/e1071/topics/naiveBayes">e1071::naiveBayes()</a></code>
</li>
<li>“nlme” from <code><a href="http://www.rdocumentation.org/packages/nlme/topics/nlme">nlme::nlme()</a></code>
</li>
<li>“nls” from <code><a href="http://www.rdocumentation.org/packages/stats/topics/nls">stats::nls()</a></code>
</li>
<li>“nnet” from <code><a href="http://www.rdocumentation.org/packages/nnet/topics/nnet">nnet::nnet()</a></code>, <code><a href="http://www.rdocumentation.org/packages/nnet/topics/multinom">nnet::multinom()</a></code>
</li>
<li>“plm” from <code><a href="http://www.rdocumentation.org/packages/plm/topics/plm">plm::plm()</a></code>
</li>
<li>“polr” from <code><a href="http://www.rdocumentation.org/packages/MASS/topics/polr">MASS::polr()</a></code>
</li>
<li>“ppr” from <code><a href="http://www.rdocumentation.org/packages/stats/topics/ppr">stats::ppr()</a></code>
</li>
<li>“princomp” from <code><a href="http://www.rdocumentation.org/packages/stats/topics/princomp">stats::princomp()</a></code>
</li>
<li>“qda” from <code>MASS:qda()</code>
</li>
<li>“rlm” from <code><a href="http://www.rdocumentation.org/packages/MASS/topics/rlm">MASS::rlm()</a></code>
</li>
<li>“rpart” from <code><a href="http://www.rdocumentation.org/packages/rpart/topics/rpart">rpart::rpart()</a></code>
</li>
<li>“rq” from <code><a href="http://www.rdocumentation.org/packages/quantreg/topics/rq">quantreg::rq()</a></code>
</li>
<li>“selection” from <code><a href="http://www.rdocumentation.org/packages/sampleSelection/topics/selection">sampleSelection::selection()</a></code>
</li>
<li>“speedglm” from <code><a href="http://www.rdocumentation.org/packages/speedglm/topics/speedglm">speedglm::speedglm()</a></code>
</li>
<li>“speedlm” from <code><a href="http://www.rdocumentation.org/packages/speedglm/topics/speedlm">speedglm::speedlm()</a></code>
</li>
<li>“survreg” from <code><a href="http://www.rdocumentation.org/packages/survival/topics/survreg">survival::survreg()</a></code>
</li>
<li>“svm” from <code><a href="http://www.rdocumentation.org/packages/e1071/topics/svm">e1071::svm()</a></code>
</li>
<li>“svyglm” from <code><a href="http://www.rdocumentation.org/packages/survey/topics/svyglm">survey::svyglm()</a></code>
</li>
<li>“tobit” from <code><a href="http://www.rdocumentation.org/packages/AER/topics/tobit">AER::tobit()</a></code>
</li>
<li>“train” from <code><a href="http://www.rdocumentation.org/packages/caret/topics/train">caret::train()</a></code>
</li>
<li>“truncreg” from <code><a href="http://www.rdocumentation.org/packages/truncreg/topics/truncreg">truncreg::truncreg()</a></code>
</li>
<li>“zeroinfl” from <code><a href="http://www.rdocumentation.org/packages/pscl/topics/zeroinfl">pscl::zeroinfl()</a></code>
</li>
</ul>
</div>
<div id="requirements-and-installation" class="section level2">
<h2 class="hasAnchor">
<a href="#requirements-and-installation" class="anchor"></a>Requirements and Installation</h2>
<p><a href="https://cran.r-project.org/package=prediction"><img src="https://www.r-pkg.org/badges/version/prediction" alt="CRAN"></a> <img src="https://cranlogs.r-pkg.org/badges/prediction" alt="Downloads"><a href="https://travis-ci.org/leeper/prediction"><img src="https://travis-ci.org/leeper/prediction.svg?branch=master" alt="Build Status"></a> <a href="https://ci.appveyor.com/project/leeper/prediction/branch/master"><img src="https://ci.appveyor.com/api/projects/status/a4tebeoa98cq07gy/branch/master?svg=true" alt="Build status"></a> <a href="https://codecov.io/github/leeper/prediction?branch=master"><img src="https://codecov.io/github/leeper/prediction/coverage.svg?branch=master" alt="codecov.io"></a> <a href="http://www.repostatus.org/#active"><img src="http://www.repostatus.org/badges/latest/active.svg" alt="Project Status: Active - The project has reached a stable, usable state and is being actively developed."></a></p>
<p>The development version of this package can be installed directly from GitHub using <code>remotes</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(<span class="st">"remotes"</span>)) {
    <span class="kw">install.packages</span>(<span class="st">"remotes"</span>)
}
remotes<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/remotes/topics/install_github">install_github</a></span>(<span class="st">"leeper/prediction"</span>)</code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=prediction">https://​cloud.r-project.org/​package=prediction</a>
</li>
<li>Browse source code at <br><a href="https://github.com/leeper/prediction">https://​github.com/​leeper/​prediction</a>
</li>
<li>Report a bug at <br><a href="https://github.com/leeper/prediction/issues">https://​github.com/​leeper/​prediction/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="citation">
<h2>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html">Citing prediction</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Thomas J. Leeper <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-4097-6326" target="orcid.widget"><img src="https://members.orcid.org/sites/default/files/vector_iD_icon.svg" class="orcid" height="16"></a> </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Thomas J. Leeper.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
